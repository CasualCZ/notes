<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Flask #  安装 #  pip install flask   程序基本结构 #   初始化  所有 Flask 程序都必须创建一个程序实例。Web 服务器使用一种名为 Web 服务器网关接口（Web Server Gateway Interface，WSGI）的协议，把接收自客户端的所有请求都转交给这个对象处理。
from flask import Flask app = Flask(&#39;__name__&#39;)  路由和函数  程序实例需要知道对每个URL请求运行哪些代码，所以保存了一个URL到Python函数的映射关系。处理URL和函数之间关系的程序称为路由。 在Flask程序中定义路由的最简便方式，是使用程序实例提供的app.route修饰器，把修饰的函数注册为路由。
@app.route(&#39;/&#39;) def index(): return &#39;&lt;h1&gt;Hello World!&lt;/h1&gt;&#39;   启动服务
if name == &lsquo;main&rsquo; app.run(Debug=True)
   模版 #  模板是一个包含响应文本的文件，其中包含用占位变量表示的动态部分，其具体值只在请求的上下文中才能知道。使用真实值替换变量，再返回最终得到的响应字符串，这一过程称为渲染。为了渲染模板，Flask 使用了一个名为 Jinja2 的强大模板引擎。
Jinja2模板引擎 #  templates/user.html：Jinja2 模板
&lt;h1&gt;Hello {{ name }} !">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="" />
<meta property="og:description" content="Flask #  安装 #  pip install flask   程序基本结构 #   初始化  所有 Flask 程序都必须创建一个程序实例。Web 服务器使用一种名为 Web 服务器网关接口（Web Server Gateway Interface，WSGI）的协议，把接收自客户端的所有请求都转交给这个对象处理。
from flask import Flask app = Flask(&#39;__name__&#39;)  路由和函数  程序实例需要知道对每个URL请求运行哪些代码，所以保存了一个URL到Python函数的映射关系。处理URL和函数之间关系的程序称为路由。 在Flask程序中定义路由的最简便方式，是使用程序实例提供的app.route修饰器，把修饰的函数注册为路由。
@app.route(&#39;/&#39;) def index(): return &#39;&lt;h1&gt;Hello World!&lt;/h1&gt;&#39;   启动服务
if name == &lsquo;main&rsquo; app.run(Debug=True)
   模版 #  模板是一个包含响应文本的文件，其中包含用占位变量表示的动态部分，其具体值只在请求的上下文中才能知道。使用真实值替换变量，再返回最终得到的响应字符串，这一过程称为渲染。为了渲染模板，Flask 使用了一个名为 Jinja2 的强大模板引擎。
Jinja2模板引擎 #  templates/user.html：Jinja2 模板
&lt;h1&gt;Hello {{ name }} !" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cctrip.github.io/notes/docs/technology/program/Language/python/Framework/Flask/flask/" />
<meta property="article:modified_time" content="2020-07-05T11:05:21+08:00" />
<title>Flask | 学而不思则罔</title>
<link rel="manifest" href="/notes/manifest.json">
<link rel="icon" href="/notes/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/notes/book.min.b3215d9d1d18d9051e7fbe8f256ff80e30f41d29073b86348e230d297b771002.css" integrity="sha256-syFdnR0Y2QUef76PJW/4DjD0HSkHO4Y0jiMNKXt3EAI=">
<script defer src="/notes/en.search.min.4784a081ceca6ce5fd2e0efaf0820a08ca5723594ce7dc05090e1ec609db3dbe.js" integrity="sha256-R4Sggc7KbOX9Lg768IIKCMpXI1lM59wFCQ4exgnbPb4="></script>

<script defer src="/notes/sw.min.2ab779ae2b5d50aeddfdd9ec3d03b41a76a3dc7461eedf8a74bbc49ef33e61e8.js" integrity="sha256-Krd5ritdUK7d/dnsPQO0Gnaj3HRh7t&#43;KdLvEnvM&#43;Yeg="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir=>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/notes"><img src="/notes/cc.jpg" alt="Logo" /><span>学而不思则罔</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  



  
  
  
  

  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
    <a href="/notes/docs/technology/" class="">技术相关</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/notes/docs/technology/system/" class="collapsed ">系统</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/technology/network/" class="collapsed ">网络</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/technology/program/" class="collapsed ">编程</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/notes/docs/technology/program/Basic/" class="collapsed ">编程基础</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/technology/program/Revision/" class="collapsed ">版本控制</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/technology/program/Language/" class="collapsed ">编程语言</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/notes/docs/technology/program/Language/shell/" class="collapsed ">Shell</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/technology/program/Language/golang/" class="collapsed ">Golang</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/technology/program/Language/python/" class="collapsed ">Python</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/notes/docs/technology/program/Language/python/CookBook/DataStructuresAndAlgorithms/README/" class="">R E a D M E</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/technology/program/Language/python/CookBook/StringsAndText/README/" class="">R E a D M E</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/technology/program/Language/python/Framework/Django/django/" class="">Django</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/technology/program/Language/python/Framework/Flask/flask/" class="active">Flask</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/technology/program/Language/python/Framework/Scrapy/scrapy/" class="">Scrapy</a>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/technology/program/Advanced/" class="collapsed ">编程进阶</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/technology/database/" class="collapsed ">数据库</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/technology/architecture/" class="collapsed ">架构</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/technology/cloud/" class="collapsed ">云原生</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/technology/bigdata/" class="collapsed ">大数据</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/technology/security/" class="collapsed ">安全</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/technology/tool/" class="collapsed ">工具</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/technology/other/" class="collapsed ">其他</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
    <a href="/notes/docs/other/" class="">非技术相关</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/notes/docs/other/life/" class="collapsed ">人生</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/notes/docs/other/learn/" class="collapsed ">方法论</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
  </ul>
  











  
<ul>
  
  <li>
    <a href="https://cctrip.github.io/" target="_blank" rel="noopener">
        关于我
      </a>
  </li>
  
  <li>
    <a href="https://cctrip.github.io/posts" target="_blank" rel="noopener">
        Blog
      </a>
  </li>
  
  <li>
    <a href="https://github.com/cctrip/notes" target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/notes/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Flask</strong>

  <label for="toc-control">
    
    <img src="/notes/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#flask">Flask</a>
      <ul>
        <li>
          <ul>
            <li><a href="#安装">安装</a></li>
            <li><a href="#程序基本结构">程序基本结构</a></li>
            <li><a href="#模版">模版</a></li>
            <li><a href="#web表单">WEB表单</a></li>
            <li><a href="#数据库">数据库</a></li>
            <li><a href="#电子邮件">电子邮件</a></li>
            <li><a href="#项目结构">项目结构</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="flask">
  Flask
  <a class="anchor" href="#flask">#</a>
</h1>
<h3 id="安装">
  安装
  <a class="anchor" href="#%e5%ae%89%e8%a3%85">#</a>
</h3>
<pre><code>pip install flask
</code></pre>
<hr>
<h3 id="程序基本结构">
  程序基本结构
  <a class="anchor" href="#%e7%a8%8b%e5%ba%8f%e5%9f%ba%e6%9c%ac%e7%bb%93%e6%9e%84">#</a>
</h3>
<ol>
<li>初始化</li>
</ol>
<p>所有 Flask 程序都必须创建一个程序实例。Web 服务器使用一种名为 Web 服务器网关接口（Web Server Gateway Interface，WSGI）的协议，把接收自客户端的所有请求都转交给这个对象处理。</p>
<pre><code>from flask import Flask
app = Flask('__name__')
</code></pre>
<ol start="2">
<li>路由和函数</li>
</ol>
<p>程序实例需要知道对每个URL请求运行哪些代码，所以保存了一个URL到Python函数的映射关系。处理URL和函数之间关系的程序称为路由。
在Flask程序中定义路由的最简便方式，是使用程序实例提供的app.route修饰器，把修饰的函数注册为路由。</p>
<pre><code>@app.route('/')
def index():
    return '&lt;h1&gt;Hello World!&lt;/h1&gt;'
</code></pre>
<ol start="3">
<li>
<p>启动服务</p>
<p>if <strong>name</strong> == &lsquo;<strong>main</strong>&rsquo;
app.run(Debug=True)</p>
</li>
</ol>
<hr>
<h3 id="模版">
  模版
  <a class="anchor" href="#%e6%a8%a1%e7%89%88">#</a>
</h3>
<p>模板是一个包含响应文本的文件，其中包含用占位变量表示的动态部分，其具体值只在请求的上下文中才能知道。使用真实值替换变量，再返回最终得到的响应字符串，这一过程称为渲染。为了渲染模板，Flask 使用了一个名为 Jinja2 的强大模板引擎。</p>
<h5 id="jinja2模板引擎">
  Jinja2模板引擎
  <a class="anchor" href="#jinja2%e6%a8%a1%e6%9d%bf%e5%bc%95%e6%93%8e">#</a>
</h5>
<p>templates/user.html：Jinja2 模板</p>
<pre><code>&lt;h1&gt;Hello {{ name }} !&lt;/h1&gt;
</code></pre>
<ol>
<li>渲染模版</li>
</ol>
<p>示例，使用render_template</p>
<pre><code>@app.route('/user/&lt;name&gt;')
def user(name)
    return render_template('user.html',name=name)
</code></pre>
<ol start="2">
<li>变量</li>
</ol>
<p>Jinja2 能识别所有类型的变量，甚至是一些复杂的类型，例如列表、字典和对象。</p>
<pre><code>&lt;p&gt;A value from a dictionary: {{ mydict['key'] }}.&lt;/p&gt;
&lt;p&gt;A value from a list: {{ mylist[3] }}.&lt;/p&gt;
&lt;p&gt;A value from a list, with a variable index: {{ mylist[myintvar] }}.&lt;/p&gt;
&lt;p&gt;A value from an object's method: {{ myobj.somemethod() }}.&lt;/p&gt;
</code></pre>
<p>可以使用过滤器修改变量，过滤器名添加在变量名之后，中间使用竖线分隔。</p>
<pre><code>Hello, {{ name|capitalize }} 
</code></pre>
<p>过滤器</p>
<pre><code>safe 渲染值时不转义
capitalize 把值的首字母转换成大写，其他字母转换成小写
lower 把值转换成小写形式
upper 把值转换成大写形式
title 把值中每个单词的首字母都转换成大写
trim 把值的首尾空格去掉
striptags 渲染之前把值中所有的 HTML 标签都删掉
</code></pre>
<ol start="3">
<li>控制结构</li>
</ol>
<p>Jinja2 提供了多种控制结构，可用来改变模板的渲染流程。</p>
<pre><code>{% 控制条件 %}
</code></pre>
<hr>
<h5 id="使用flask-bootstrap集成twitter-bootstrap">
  使用Flask-Bootstrap集成Twitter Bootstrap
  <a class="anchor" href="#%e4%bd%bf%e7%94%a8flask-bootstrap%e9%9b%86%e6%88%90twitter-bootstrap">#</a>
</h5>
<p>Bootstrap是Twitter开发的一个开源框架，它提供的用户界面组件可用于创建整洁且具有吸引力的网页，而且这些网页还能兼容所有现代 Web 浏览器。</p>
<pre><code>pip install flask-bootstrap
</code></pre>
<ol>
<li>初始化</li>
</ol>
<p>示例</p>
<pre><code>from flask.ext.bootstrap import Bootstrap
bootstrap = Bootstrap(app)
</code></pre>
<hr>
<h5 id="自定义错误页面">
  自定义错误页面
  <a class="anchor" href="#%e8%87%aa%e5%ae%9a%e4%b9%89%e9%94%99%e8%af%af%e9%a1%b5%e9%9d%a2">#</a>
</h5>
<pre><code>@app.errorhandler(404)
def page_not_found(e):
 return render_template('404.html'), 404
@app.errorhandler(500)
def internal_server_error(e):
 return render_template('500.html'), 500
</code></pre>
<hr>
<h5 id="链接">
  链接
  <a class="anchor" href="#%e9%93%be%e6%8e%a5">#</a>
</h5>
<p>Flask 提供了 url_for() 辅助函数，它可以使用程序 URL 映射中保存的信息生成 URL。</p>
<h5 id="静态文件">
  静态文件
  <a class="anchor" href="#%e9%9d%99%e6%80%81%e6%96%87%e4%bb%b6">#</a>
</h5>
<hr>
<h5 id="使用flask-moment本地化日期和时间">
  使用Flask-Moment本地化日期和时间
  <a class="anchor" href="#%e4%bd%bf%e7%94%a8flask-moment%e6%9c%ac%e5%9c%b0%e5%8c%96%e6%97%a5%e6%9c%9f%e5%92%8c%e6%97%b6%e9%97%b4">#</a>
</h5>
<p>示例</p>
<pre><code>pip install flask-moment
from flask.ext.moment import Moment
moment = Moment(app)

{% block scripts %}
{{ super() }}
{{ moment.include_moment() }}
{% endblock %}

&lt;p&gt;The local date and time is {{ moment(current_time).format('LLL') }}.&lt;/p&gt;
</code></pre>
<hr>
<h3 id="web表单">
  WEB表单
  <a class="anchor" href="#web%e8%a1%a8%e5%8d%95">#</a>
</h3>
<p>示例</p>
<pre><code>pip install flask-wtf
from flask.ext.wtf import Form
from wtforms import StringField, SubmitField
from wtforms.validators import Required
class NameForm(Form):
    name = StringField('What is your name?', validators=[Required()])
    submit = SubmitField('Submit')
</code></pre>
<p>表单渲染</p>
<pre><code>{% import &quot;bootstrap/wtf.html&quot; as wtf %}
{{ wtf.quick_form(form) }}
</code></pre>
<p>视图处理表单：</p>
<pre><code>form = NameForm()
return render_template('index.html', form=form)
</code></pre>
<hr>
<h3 id="数据库">
  数据库
  <a class="anchor" href="#%e6%95%b0%e6%8d%ae%e5%ba%93">#</a>
</h3>
<p>初始化</p>
<pre><code>pip install flask-sqlalchemy

from flask.ext.sqlalchemy import SQLAlchemy
basedir = os.path.abspath(os.path.dirname(__file__))
app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] =\
'sqlite:///' + os.path.join(basedir, 'data.sqlite')
app.config['SQLALCHEMY_COMMIT_ON_TEARDOWN'] = True
db = SQLAlchemy(app)
</code></pre>
<p>模型定义</p>
<pre><code>class Role(db.Model):
    __tablename__ = 'roles'
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(64), unique=True)
    def __repr__(self):
        return '&lt;Role %r&gt;' % self.name
</code></pre>
<p>创建表</p>
<pre><code>db.create_all()
</code></pre>
<p>插入行</p>
<pre><code>from hello import Role
admin_role = Role(name='Admin')
db.session.add(admin_role)
db.session.commit()
</code></pre>
<hr>
<h3 id="电子邮件">
  电子邮件
  <a class="anchor" href="#%e7%94%b5%e5%ad%90%e9%82%ae%e4%bb%b6">#</a>
</h3>
<pre><code>pip install flask-mail
</code></pre>
<hr>
<h3 id="项目结构">
  项目结构
  <a class="anchor" href="#%e9%a1%b9%e7%9b%ae%e7%bb%93%e6%9e%84">#</a>
</h3>
<p>多文件 Flask 程序的基本结构</p>
<p>flasky</p>
<ul>
<li>app/
<ul>
<li>templates/</li>
<li>static/</li>
<li>main/
<ul>
<li><strong>init</strong>.py</li>
<li>errors.py</li>
<li>forms.py</li>
<li>views.py</li>
</ul>
</li>
<li><strong>init</strong>.py</li>
<li>email.py</li>
<li>models.py</li>
</ul>
</li>
<li>migrations/</li>
<li>tests/
<ul>
<li><strong>init</strong>.py</li>
<li>test*.py</li>
</ul>
</li>
<li>venv/</li>
<li>requirements.txt</li>
<li>config.py</li>
<li>manage.py</li>
</ul>
<p>这种结构有 4 个顶级文件夹：</p>
<ul>
<li>Flask 程序一般都保存在名为 app 的包中；</li>
<li>和之前一样，migrations 文件夹包含数据库迁移脚本；</li>
<li>单元测试编写在 tests 包中；</li>
<li>和之前一样，venv 文件夹包含 Python 虚拟环境。
同时还创建了一些新文件：</li>
<li>requirements.txt 列出了所有依赖包，便于在其他电脑中重新生成相同的虚拟环境；</li>
<li>config.py 存储配置；</li>
<li>manage.py 用于启动程序以及其他的程序任务。</li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">



  <div><a class="flex align-center" href="https://github.com/cctrip/notes/commit/da83eca9f7dac04cd1e150a1bb3448cf19e06a46" title='Last modified by codecc | July 5, 2020' target="_blank" rel="noopener">
      <img src="/notes/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>July 5, 2020</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/cctrip/notes/edit/master/content/docs/technology/program/Language/python/Framework/Flask/flask.md" target="_blank" rel="noopener">
      <img src="/notes/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>

</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#flask">Flask</a>
      <ul>
        <li>
          <ul>
            <li><a href="#安装">安装</a></li>
            <li><a href="#程序基本结构">程序基本结构</a></li>
            <li><a href="#模版">模版</a></li>
            <li><a href="#web表单">WEB表单</a></li>
            <li><a href="#数据库">数据库</a></li>
            <li><a href="#电子邮件">电子邮件</a></li>
            <li><a href="#项目结构">项目结构</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












